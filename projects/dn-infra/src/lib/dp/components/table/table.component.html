<form #myForm="ngForm">

  form valid? {{myForm.valid}}
  <br>
  <br>
  form values: {{myForm.value | json}}
  <br>
  <br>
  <p-table #dt [columns]="definition.columns" [value]="datasource" [dataKey]="definition.dataKey"
    [rowHover]="definition.rowHover" [rows]="definition.rows" [showCurrentPageReport]="true"
    [rowsPerPageOptions]="definition.rowsPerPageOptions" [paginator]="definition.paginator"
    [currentPageReportTemplate]="definition.currentPageReportTemplate" [editMode]="definition.editMode"
    [sortMode]="'multiple'" [(first)]="first" [selectionMode]="definition.selectionMode"
    [scrollHeight]="definition.FreezeHeaderTableHeight" [scrollable]="definition.scrollable">
    <ng-template pTemplate="caption" *ngIf="definition.toolbar">
      <div class="p-toolbar-group-left">
        <button *ngIf="isEditable" pButton type="button" icon="pi pi-plus" class="ui-button-info" [label]="'Add'"
          (click)="addRow()" pAddRow>
        </button>
        <button *ngIf="definition.exportToExcel" type="button" pButton pRipple icon="pi pi-file-excel" [label]="'Excel'"
          (click)="exportExcel()" class="p-button-success p-mr-2" pTooltip="XLS" tooltipPosition="bottom">
        </button>
        <button *ngIf="definition.exportToPdf" type="button" pButton pRipple icon="pi pi-file-pdf" [label]="'PDF'"
          (click)="exportPdf()" class="p-button-warning p-mr-2" pTooltip="PDF" tooltipPosition="bottom">
        </button>
        <button pButton type="button" [icon]="toggleFilter ? 'pi pi-caret-up' : 'pi pi-caret-down'"
          class="ui-button-info" (click)="toggleFilter = !toggleFilter" pAddRow>
        </button>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <div *ngIf="definition.HeaderColGroup !== ''" [outerHTML]="definition.HeaderColGroup"></div>
      <tr>
        <th *ngFor="let column of definition.columns" [pSortableColumn]="column.fieldname">
          {{column.headername}}
          <p-sortIcon [field]="column.fieldname"></p-sortIcon>
          <span *ngIf="column.isMandatory" class="mandatory">&bull;</span>
        </th>
      </tr>
      <!-- <tr>
        <th *ngFor="let column of definition.columns" [hidden]="!toggleFilter" [ngSwitch]="column.type">

          <input *ngSwitchCase="gridColumnTypeEnum.span" pInputText type="text"
            (input)="dt.filter($event.target.value, column.fieldname, 'contains')">
          <input *ngSwitchCase="gridColumnTypeEnum.inputnumber" pInputText type="text"
            (input)="dt.filter($event.target.value, column.fieldname, 'equals')">
          <p-checkbox *ngSwitchCase="gridColumnTypeEnum.checkbox"
            (onChange)="dt.filter($event.target.value, column.fieldname, 'equals')">
          </p-checkbox>
          <p-calendar *ngSwitchCase="gridColumnTypeEnum.calendar" (onSelect)="onDateSelect($event)"
            (onClearClick)="dt.filter('', 'date', 'equals')" [showButtonBar]="true" styleClass="p-column-filter"
            placeholder="Registration Date" [readonlyInput]="true" dateFormat="dd/mm/yy" [style]="{'width':'100%'}">
          </p-calendar>

        </th>
      </tr> -->
    </ng-template>

    <ng-template [ngModelGroup]="tableId" pTemplate="body" let-index="rowIndex" let-row let-columns="columns"
      *ngIf="definition.editMode == 'cell'">
      <tr *ngIf="row" [pSelectableRow]="row">
        <td [ngModelGroup]="'row'+index" *ngFor="let column of columns" [pEditableColumn]="row"
          [pEditableColumnField]="column">
          <!-- <app-cell [ngModel]="row" [name]="'row'+index" [rowIndex]="index" [row]="row" [column]="column"></app-cell> -->

          <ng-container *ngIf="column.iseditable else notEditable">

            <ng-container [ngSwitch]="column.type">

              <dp-inputtext  [required]="column.isMandatory" name="{{column.fieldname}}"
                *ngSwitchCase="gridColumnTypeEnum.span" ngModel="{{row[column.fieldname]}}" [columnDefinition]="column">
              </dp-inputtext>


              <dp-checkbox *ngSwitchCase="gridColumnTypeEnum.checkbox" ngModel="{{row[column.fieldname]}}"
                name="{{column.fieldname}}">
              </dp-checkbox>

              <dp-inputnumber [required]="column.isMandatory" ngModel="{{row[column.fieldname]}}"
                name="{{column.fieldname}}" [columnDefinition]="column" *ngSwitchCase="gridColumnTypeEnum.inputnumber">
              </dp-inputnumber>

              <img *ngSwitchCase="gridColumnTypeEnum.image" class="my-center-text" src="{{row[column.fieldname]}}"
                title="{{row[column.fieldname.concat('_tooltip')]}}" width="{{column.width}}"
                height="{{column.height}}">

              <dp-calendar [required]="column.isMandatory" [rowData]="row" [columnDefinition]="column"
                ngModel="{{row[column.fieldname]}}" name="{{column.fieldname}}"
                *ngSwitchCase="gridColumnTypeEnum.calendar">
              </dp-calendar>

              <dp-autocomplete  ngModel="{{row[column.fieldname]}}" 
              name="{{column.fieldname}}" *ngSwitchCase="gridColumnTypeEnum.dropdown" 
              [columnDefinition]="column"
                [datasource]="column.ColumnDatasource">
              </dp-autocomplete>

            </ng-container>
          </ng-container>

          <ng-template #notEditable>
            <ng-container [ngSwitch]="column.type">
              <span *ngSwitchCase="gridColumnTypeEnum.span" [style]="column.style" [class]="column.class">
                {{row[column.fieldname]}}
              </span>
              <span *ngSwitchCase="gridColumnTypeEnum.calendar">{{row[column.fieldname] | date: 'dd/MM/yyyy'}}</span>
              <span *ngSwitchCase="gridColumnTypeEnum.inputnumber">
                {{column.columnParams.getValueByKey(inputNumberProperties.prefix)}}
                {{row[column.fieldname]}}
                {{column.columnParams.getValueByKey(inputNumberProperties.suffix)}}
              </span>


              <dp-checkbox *ngSwitchCase="gridColumnTypeEnum.checkbox" [(ngModel)]="row[column.fieldname]"
                [name]="row[column.fieldname]">
              </dp-checkbox>


              <img *ngSwitchCase="gridColumnTypeEnum.image" class="my-center-text" src="{{row[column.fieldname]}}"
                title="{{row[column.fieldname.concat('_tooltip')]}}" width="{{column.width}}"
                height="{{column.height}}">
              <span *ngSwitchCase="gridColumnTypeEnum.dropdown">{{row[column.fieldname]}}</span>
            </ng-container>

          </ng-template>

        </td>
        <td>
          <button *ngIf="isEditable" pButton type="button" icon="pi pi-trash" class="ui-button-info"
            (click)="deleteRow(index, row)">
          </button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="8" style="text-align:left">No results found.</td>
      </tr>
    </ng-template>
    <ng-template pTemplate="footer" *ngIf="isFooter">
      <tr>
        <td *ngFor="let column of definition.columns; let i=index">
          <ng-container *ngIf="column.ColumnSum">
            <!-- {{dpCalculateColumnSum(i, column, dt)}} -->
          </ng-container>
          <ng-container *ngIf="column.ColumnTotal">
            <!-- Total: {{dpCalculateTotalRows(i, column, dt)}} -->
          </ng-container>
        </td>
      </tr>
    </ng-template>
  </p-table>
  <br>
  <br>
  <br>

</form>
